import{c as z,w as E,l as I,r as u,s as m,V as d,j as e,v as q,X as A,M as S}from"./index-Df9m1I_8.js";import{P as _}from"./plus-KoOOFxMC.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=z("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);function B(){const{id:c}=E(),g=I(),[f,p]=u.useState(!1),[h,b]=u.useState([]),[j,x]=u.useState([]),[o,v]=u.useState({title:"",description:"",price:0,location:"",address:"",bedrooms:0,bathrooms:0,size:0,image:"",images:[],property_type:"",status:"available",featured:!1});u.useEffect(()=>{c&&y()},[c]);const y=async()=>{try{const{data:a,error:r}=await m.from("properties").select("*").eq("id",c).single();if(r)throw r;a&&(v(a),a.image&&x([a.image,...a.images||[]]))}catch{d.error("Erro ao carregar imóvel"),g("/admin")}},N=a=>{const t=Array.from(a.target.files||[]).filter(s=>s.type.match(/^image\/(jpeg|png)$/)?s.size>5*1024*1024?(d.error(`${s.name} é muito grande (máximo 5MB)`),!1):!0:(d.error(`${s.name} não é um arquivo de imagem válido (JPG ou PNG)`),!1));b(s=>[...s,...t]),t.forEach(s=>{const i=new FileReader;i.onloadend=()=>{x(n=>[...n,i.result])},i.readAsDataURL(s)})},w=a=>{b(r=>r.filter((t,s)=>s!==a)),x(r=>r.filter((t,s)=>s!==a))},k=async a=>{const r=a.map(async t=>{const s=`${Date.now()}-${t.name}`,{data:i,error:n}=await m.storage.from("property-images").upload(s,t);if(n)throw n;const{data:{publicUrl:P}}=m.storage.from("property-images").getPublicUrl(s);return P});return Promise.all(r)},C=async a=>{a.preventDefault(),p(!0);try{if(!o.location||o.location.trim()===""){d.error("A localização (bairro/região) é obrigatória"),p(!1);return}const{data:{user:r},error:t}=await m.auth.getUser();if(t)throw t;if(!r){d.error("Você precisa estar logado para realizar esta ação");return}let s=[];h.length>0&&(s=await k(h));const i={...o,image:s[0]||o.image,images:s.slice(1),property_type:o.property_type||"Não informado",created_by:r.id,updated_by:r.id};if(console.log("Dados a serem salvos:",i),c){const{error:n}=await m.from("properties").update({...i,updated_by:r.id}).eq("id",c);if(n)throw n;d.success("Imóvel atualizado com sucesso")}else{const{error:n}=await m.from("properties").insert([i]);if(n)throw n;d.success("Imóvel criado com sucesso")}g("/admin")}catch(r){console.error("Erro:",r),d.error(c?"Erro ao atualizar imóvel":"Erro ao criar imóvel")}finally{p(!1)}},l=a=>{const{name:r,value:t,type:s}=a.target;v(i=>({...i,[r]:s==="checkbox"?a.target.checked:t}))};return e.jsxs("div",{className:"bg-white shadow-md rounded-lg border border-secondary-dark/10 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-accent/5 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsx("div",{className:"p-6 border-b border-secondary-dark/10 relative z-10",children:e.jsxs("h2",{className:"text-2xl font-display font-semibold text-primary flex items-center",children:[e.jsx(q,{size:22,className:"text-accent mr-2.5"}),c?"Editar Imóvel":"Adicionar Novo Imóvel"]})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Imagens do Imóvel"}),e.jsxs("div",{className:"mt-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[j.map((a,r)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a,alt:`Prévia ${r+1}`,className:"h-32 w-full object-cover rounded-sm"}),e.jsx("button",{type:"button",onClick:()=>w(r),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(A,{size:16})})]},r)),e.jsxs("label",{className:"relative h-32 flex items-center justify-center border-2 border-neutral-300 border-dashed rounded-sm cursor-pointer hover:border-gold",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"mx-auto h-8 w-8 text-neutral-400"}),e.jsx("span",{className:"mt-2 block text-sm font-medium text-neutral-600",children:"Adicionar Imagem"})]}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png",className:"hidden",onChange:N,multiple:!0})]})]}),e.jsx("p",{className:"mt-2 text-xs text-neutral-500",children:"PNG, JPG até 5MB cada. A primeira imagem será a imagem principal do imóvel."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Título"}),e.jsx("input",{type:"text",name:"title",value:o.title,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Descrição"}),e.jsx("textarea",{name:"description",value:o.description,onChange:l,required:!0,rows:4,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Localização (Bairro/Região)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx(S,{size:16,className:"text-accent"})}),e.jsx("input",{type:"text",name:"location",value:o.location,onChange:l,required:!0,placeholder:"Ex: Centro, Moinhos de Vento, Bela Vista",className:"mt-1 block w-full pl-10 rounded-sm border-neutral-300 shadow-sm focus:border-accent focus:ring focus:ring-accent focus:ring-opacity-50"})]}),e.jsx("p",{className:"mt-1 text-xs text-neutral-500",children:"Esta informação será exibida no card do imóvel e é crucial para os compradores. Por favor, preencha com o bairro ou região do imóvel."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Endereço Completo"}),e.jsx("textarea",{name:"address",value:o.address,onChange:l,rows:1,placeholder:"Ex: Rua Exemplo, 123, Apto 101, CEP 90000-000",className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"}),e.jsxs("p",{className:"mt-1 text-xs text-neutral-500 flex items-center",children:[e.jsx("span",{className:"bg-accent/10 text-accent rounded-sm px-2 py-0.5 mr-2 font-medium",children:"Informação pública"}),"Este endereço será exibido na página do imóvel e visível para todos os visitantes"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Preço"}),e.jsx("input",{type:"number",name:"price",value:o.price,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Tipo de Imóvel"}),e.jsxs("select",{name:"property_type",value:o.property_type,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),e.jsx("option",{value:"Casa",children:"Casa"}),e.jsx("option",{value:"Apartamento",children:"Apartamento"}),e.jsx("option",{value:"Cobertura",children:"Cobertura"}),e.jsx("option",{value:"Mansão",children:"Mansão"}),e.jsx("option",{value:"Terreno",children:"Terreno"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Quartos"}),e.jsx("input",{type:"number",name:"bedrooms",value:o.bedrooms,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Banheiros"}),e.jsx("input",{type:"number",name:"bathrooms",value:o.bathrooms,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Área (m²)"}),e.jsx("input",{type:"number",name:"size",value:o.size,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:o.status,onChange:l,required:!0,className:"mt-1 block w-full rounded-sm border-neutral-300 shadow-sm focus:border-gold focus:ring focus:ring-gold focus:ring-opacity-50",children:[e.jsx("option",{value:"available",children:"Disponível"}),e.jsx("option",{value:"sold",children:"Vendido"}),e.jsx("option",{value:"pending",children:"Reservado"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"featured",name:"featured",checked:o.featured,onChange:l,className:"h-4 w-4 text-gold focus:ring-gold border-neutral-300 rounded"}),e.jsx("label",{htmlFor:"featured",className:"text-sm font-medium text-neutral-700",children:"Destacar este imóvel na página inicial"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>g("/admin"),className:"px-4 py-2 border border-neutral-300 rounded-lg text-sm font-medium text-primary hover:bg-secondary transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:f,className:"px-5 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-accent hover:bg-accent-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-300 disabled:opacity-50 flex items-center",children:[e.jsx(D,{size:16,className:"mr-1.5"}),f?"Salvando...":c?"Atualizar Imóvel":"Criar Imóvel"]})]})]})})]})}export{B as default};
